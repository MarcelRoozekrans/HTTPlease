

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using HttpRequest &mdash; HTTPlease 1.8.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="HTTPlease 1.8.2 documentation" href="../../index.html"/>
        <link rel="up" title="HttpRequest" href="index.html"/>
        <link rel="next" title="HttpRequest&lt;TContext&gt;" href="../typed/index.html"/>
        <link rel="prev" title="HttpRequest" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> HTTPlease
          

          
          </a>

          
            
            
              <div class="version">
                1.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../uri-templates/index.html">URI Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../clients/index.html">Clients</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Requests</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">HttpRequest</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-request-from-a-uri">Creating a request from a URI</a></li>
<li class="toctree-l4"><a class="reference internal" href="#binding-request-parameters">Binding request parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#binding-request-parameters-to-an-object-s-properties">Binding request parameters to an object’s properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-request-with-late-bound-parameters">Creating a request with late-bound parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#working-with-responses">Working with responses</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../typed/index.html">HttpRequest&lt;TContext&gt;</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../extensibility/index.html">Extensibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">HTTPlease</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Requests</a> &raquo;</li>
        
          <li><a href="index.html">HttpRequest</a> &raquo;</li>
        
      <li>Using HttpRequest</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-httprequest">
<h1>Using HttpRequest<a class="headerlink" href="#using-httprequest" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="#creating-a-request-from-a-uri">Creating a request from a URI</a></li>
<li><a class="reference internal" href="#binding-request-parameters">Binding request parameters</a></li>
<li><a class="reference internal" href="#binding-request-parameters-to-an-object-s-properties">Binding request parameters to an object’s properties</a></li>
<li><a class="reference internal" href="#creating-a-request-with-late-bound-parameters">Creating a request with late-bound parameters</a></li>
<li><a class="reference internal" href="#working-with-responses">Working with responses</a><ul>
<li><a class="reference internal" href="#just-give-me-the-response">Just give me the response</a></li>
<li><a class="reference internal" href="#i-want-to-handle-specific-status-codes">I want to handle specific status codes</a></li>
<li><a class="reference internal" href="#i-want-to-handle-failure-status-codes-as-exceptions">I want to handle failure status codes as exceptions</a></li>
<li><a class="reference internal" href="#some-basic-data-types">Some basic data-types</a></li>
</ul>
</li>
</ul>
<div class="section" id="creating-a-request-from-a-uri">
<h2>Creating a request from a URI<a class="headerlink" href="#creating-a-request-from-a-uri" title="Permalink to this headline">¶</a></h2>
<p>First, let’s define a request that will act as the basis for the requests in subsequent examples.</p>
<p>Note that, if you prefer, you don’t have to do this separately (you can declare the full URI in-place where you use it).
You can also use relative URIs (in which case the the HttpClient’s base URI will be used).</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">HttpRequest</span> <span class="n">baseRequest</span> <span class="p">=</span> <span class="n">HttpRequest</span><span class="p">.</span><span class="n">Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">&quot;http://localhost:1234&quot;</span><span class="p">);</span>
<span class="n">HttpRequest</span> <span class="n">requestTemplate</span> <span class="p">=</span> <span class="n">baseRequest</span><span class="p">.</span><span class="n">WithRelativeRequestUri</span><span class="p">(</span>
    <span class="s">&quot;customers/{variable1}/foo/{variable2}/bar&quot;</span>
<span class="p">);</span>

<span class="c1">// Full request URI is now http://localhost:1234/customers/{variable1}/foo/{variable2}/bar</span>
<span class="c1">// Note the use of parameters (the bits in braces). That means this URI is a template.</span>
</pre></div>
</div>
</div>
<div class="section" id="binding-request-parameters">
<h2>Binding request parameters<a class="headerlink" href="#binding-request-parameters" title="Permalink to this headline">¶</a></h2>
<p>The parameters (or “holes”) in the request URI must be bound to values before the request can be invoked.
One way to do this is to give the parameters constant values by specialising the template:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="p">(</span><span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClient</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">HttpRequest</span> <span class="n">request</span> <span class="p">=</span>
        <span class="n">requestTemplate</span>
            <span class="p">.</span><span class="n">WithQueryParameter</span><span class="p">(</span><span class="s">&quot;sort&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="n">WithTemplateParameter</span><span class="p">(</span><span class="s">&quot;variable1&quot;</span><span class="p">,</span> <span class="m">1234</span><span class="p">)</span>
            <span class="p">.</span><span class="n">WithTemplateParameter</span><span class="p">(</span><span class="s">&quot;variable2&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="k">null</span><span class="p">);</span>

    <span class="k">using</span> <span class="p">(</span><span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">GetAsync</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// Request URI will be:</span>
        <span class="c1">//    http://localhost:1234/customers/1234/foo/bar?sort=name</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that while all of a request’s parameters must be bound, they can be have a value of <code class="docutils literal notranslate"><span class="pre">null</span></code> which will result in their path segment / query parameter being omitted from the final URI.</p>
</div>
<div class="section" id="binding-request-parameters-to-an-object-s-properties">
<h2>Binding request parameters to an object’s properties<a class="headerlink" href="#binding-request-parameters-to-an-object-s-properties" title="Permalink to this headline">¶</a></h2>
<p>The parameters in the request URI can also be bound to the properties of an object (including anonymous types).
If you’re not using anonymous types (or other immutable object types) then you may be better off using <a class="reference external" href="../typed/index">HttpRequest&lt;TContext&gt;</a>.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="p">(</span><span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClient</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">HttpRequest</span> <span class="n">request</span> <span class="p">=</span>
        <span class="n">requestTemplate</span>
            <span class="p">.</span><span class="n">WithQueryParameter</span><span class="p">(</span><span class="s">&quot;sort&quot;</span><span class="p">,</span> <span class="s">&quot;name&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="n">WithTemplateParameters</span><span class="p">(</span><span class="k">new</span>
            <span class="p">{</span>
                <span class="n">variable1</span> <span class="p">=</span> <span class="m">1234</span><span class="p">,</span>
                <span class="n">variable2</span> <span class="p">=</span> <span class="s">&quot;baz&quot;</span>
            <span class="p">});</span>

    <span class="k">using</span> <span class="p">(</span><span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">GetAsync</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// Request URI will be:</span>
        <span class="c1">//    http://localhost:1234/customers/1234/foo/baz/bar?sort=name</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-request-with-late-bound-parameters">
<h2>Creating a request with late-bound parameters<a class="headerlink" href="#creating-a-request-with-late-bound-parameters" title="Permalink to this headline">¶</a></h2>
<p>Instead of constant values, however, request parameters can also be bound to delegates that resolve their values each time the request is invoked.</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="p">(</span><span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClient</span><span class="p">())</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">variable1</span> <span class="p">=</span> <span class="m">1234</span><span class="p">;</span>
    <span class="kt">string</span> <span class="n">variable2</span> <span class="p">=</span> <span class="s">&quot;hello&quot;</span><span class="p">;</span>

    <span class="n">HttpRequest</span> <span class="n">request</span> <span class="p">=</span>
        <span class="n">requestTemplate</span>
            <span class="p">.</span><span class="n">WithQueryParameter</span><span class="p">(</span><span class="s">&quot;diddly&quot;</span><span class="p">,</span> <span class="s">&quot;bonk&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="n">WithTemplateParameter</span><span class="p">(</span><span class="s">&quot;variable1&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">variable1</span><span class="p">))</span>
            <span class="p">.</span><span class="n">WithTemplateParameter</span><span class="p">(</span><span class="s">&quot;variable2&quot;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="n">variable2</span><span class="p">);</span>

    <span class="k">using</span> <span class="p">(</span><span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">GetAsync</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// Request URI will be:</span>
        <span class="c1">//    http://localhost:1234/customers/1234/foo/hello/bar?diddly=bonk</span>
    <span class="p">}</span>

    <span class="c1">// Let&#39;s give &quot;variable2&quot; a value so that its path segment will be present in the final URI.</span>
    <span class="n">variable2</span> <span class="p">=</span> <span class="s">&quot;hello world&quot;</span><span class="p">;</span>

    <span class="k">using</span> <span class="p">(</span><span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">GetAsync</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// Request URI will be:</span>
        <span class="c1">//    http://localhost:1234/customers/1234/foo/hello%20world/bar?diddly=bonk</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="working-with-responses">
<h2>Working with responses<a class="headerlink" href="#working-with-responses" title="Permalink to this headline">¶</a></h2>
<p>HTTPlease offers several styles of interaction with the responses from HTTP requests.
These range from simple / low-ceremony to fully-customisable.</p>
<p>Click <a class="reference internal" href="#data-types"><span class="std std-ref">here</span></a> for the definitions of some basic data-types used in these examples.</p>
<div class="section" id="just-give-me-the-response">
<h3>Just give me the response<a class="headerlink" href="#just-give-me-the-response" title="Permalink to this headline">¶</a></h3>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="p">(</span><span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClient</span> <span class="p">{</span> <span class="n">BaseAddress</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Uri</span><span class="p">(</span><span class="s">&quot;http://localhost:1234/&quot;</span><span class="p">)</span> <span class="p">})</span>
<span class="p">{</span>
    <span class="n">HttpRequest</span> <span class="n">request</span> <span class="p">=</span> <span class="n">HttpRequest</span><span class="p">.</span><span class="n">Factory</span><span class="p">.</span><span class="n">CreateJson</span><span class="p">(</span><span class="s">&quot;customers/1&quot;</span><span class="p">);</span>

    <span class="c1">// Uses appropriate formatter(s) configured above by calling CreateJson.</span>
    <span class="n">Customer</span> <span class="n">customer</span> <span class="p">=</span>
        <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">GetAsync</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="p">.</span><span class="n">ReadAsAsync</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="i-want-to-handle-specific-status-codes">
<h3>I want to handle specific status codes<a class="headerlink" href="#i-want-to-handle-specific-status-codes" title="Permalink to this headline">¶</a></h3>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="p">(</span><span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClient</span> <span class="p">{</span> <span class="n">BaseAddress</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Uri</span><span class="p">(</span><span class="s">&quot;http://localhost:1234/&quot;</span><span class="p">)</span> <span class="p">})</span>
<span class="p">{</span>
    <span class="n">HttpRequest</span> <span class="n">request</span> <span class="p">=</span> <span class="n">HttpRequest</span><span class="p">.</span><span class="n">Factory</span><span class="p">.</span><span class="n">CreateJson</span><span class="p">(</span><span class="s">&quot;customers/1&quot;</span><span class="p">);</span>

    <span class="k">using</span> <span class="p">(</span><span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">GetAsync</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// Handle specific status codes.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span> <span class="p">==</span> <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">BadRequest</span> <span class="p">||</span> <span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span> <span class="p">==</span> <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">Forbidden</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Error</span> <span class="n">error</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">ReadContentAsAsync</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">&gt;();</span>

            <span class="k">throw</span> <span class="k">new</span> <span class="n">HttpRequestException</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">&gt;(</span><span class="n">error</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// For all other status codes, use standard behaviour for deciding whether the response indicates success.</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">response</span><span class="p">.</span><span class="n">IsSuccessStatusCode</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">HttpRequestException</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span>
                <span class="s">&quot;The request failed because an unexpected status code ({0}) was received from the server.&quot;</span><span class="p">,</span>
                <span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Uses appropriate formatter(s) configured above by calling CreateJson.</span>
        <span class="n">Customer</span> <span class="n">customer</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">ReadContentAsAsync</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="i-want-to-handle-failure-status-codes-as-exceptions">
<h3>I want to handle failure status codes as exceptions<a class="headerlink" href="#i-want-to-handle-failure-status-codes-as-exceptions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="n">HttpRequest</span> <span class="n">request</span> <span class="p">=</span> <span class="n">HttpRequest</span><span class="p">.</span><span class="n">Factory</span><span class="p">.</span><span class="n">CreateJson</span><span class="p">(</span><span class="s">&quot;customers/1&quot;</span><span class="p">);</span>

<span class="k">using</span> <span class="p">(</span><span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClient</span><span class="p">())</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="c1">// If status code indicates success, read response as Customer.</span>
        <span class="c1">// If status code indicates failure, read response as Error and throw.</span>
        <span class="c1">// You can also tell ReadAsAsync which status code(s) indicate success.</span>

        <span class="n">Customer</span> <span class="n">customer</span> <span class="p">=</span>
            <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">GetAsync</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
                <span class="p">.</span><span class="n">ReadAsAsync</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span> <span class="n">Error</span><span class="p">&gt;();</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">HttpRequestException</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">&gt;</span> <span class="n">expectedError</span><span class="p">)</span>
      <span class="n">when</span> <span class="n">expectedError</span><span class="p">.</span><span class="n">StatusCode</span> <span class="p">==</span> <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">NotFound</span>
    <span class="p">{</span>
        <span class="n">Error</span> <span class="n">errorResponse</span> <span class="p">=</span> <span class="n">expectedError</span><span class="p">.</span><span class="n">Response</span><span class="p">;</span>

        <span class="n">Log</span><span class="p">.</span><span class="n">Error</span><span class="p">(</span><span class="n">expectedError</span><span class="p">,</span> <span class="n">errorResponse</span><span class="p">.</span><span class="n">ErrorMessage</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">HttpRequestException</span><span class="p">&lt;</span><span class="n">Error</span><span class="p">&gt;</span> <span class="n">expectedError</span><span class="p">)</span>
      <span class="n">when</span> <span class="n">expectedError</span><span class="p">.</span><span class="n">StatusCode</span> <span class="p">==</span> <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">BadRequest</span>
    <span class="p">{</span>
        <span class="n">Error</span> <span class="n">errorResponse</span> <span class="p">=</span> <span class="n">expectedError</span><span class="p">.</span><span class="n">Response</span><span class="p">;</span>

        <span class="n">Log</span><span class="p">.</span><span class="n">Error</span><span class="p">(</span><span class="n">expectedError</span><span class="p">,</span> <span class="n">errorResponse</span><span class="p">.</span><span class="n">ErrorMessage</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">HttpRequestException</span> <span class="n">unexpectedError</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Unexpected error (generic request failure, or unable to read response body)</span>

        <span class="n">Log</span><span class="p">.</span><span class="n">Error</span><span class="p">(</span><span class="n">unexpectedError</span><span class="p">,</span> <span class="n">unexpectedError</span><span class="p">.</span><span class="n">Message</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="i-want-to-do-it-all-myself">
<h3>I want to do it all myself<a class="headerlink" href="#i-want-to-do-it-all-myself" title="Permalink to this headline">¶</a></h3>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="p">(</span><span class="n">HttpClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpClient</span> <span class="p">{</span> <span class="n">BaseAddress</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Uri</span><span class="p">(</span><span class="s">&quot;http://localhost:1234/&quot;</span><span class="p">)</span> <span class="p">})</span>
<span class="p">{</span>
    <span class="n">HttpRequest</span> <span class="n">request</span> <span class="p">=</span> <span class="n">HttpRequest</span><span class="p">.</span><span class="n">Factory</span><span class="p">.</span><span class="n">CreateJson</span><span class="p">(</span><span class="s">&quot;customers/1&quot;</span><span class="p">);</span>

    <span class="k">using</span> <span class="p">(</span><span class="n">HttpResponseMessage</span> <span class="n">response</span> <span class="p">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">GetAsync</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">response</span><span class="p">.</span><span class="n">EnsureSuccessStatusCode</span><span class="p">();</span>

        <span class="c1">// Perform any response message processing required.</span>

        <span class="c1">// Decide how to interpret the response body (call to CreateJson above would have told the server that we Accept &quot;application/json&quot;).</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">ContentType</span><span class="p">.</span><span class="n">MediaType</span> <span class="p">!=</span> <span class="s">&quot;application/json&quot;</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">HttpRequestException</span><span class="p">(</span>
                <span class="n">String</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;The response has an unexpected content type: &#39;{0}&#39;.&quot;</span><span class="p">,</span>
                <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">ContentType</span><span class="p">.</span><span class="n">MediaType</span>
            <span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Let&#39;s customise the JSON formatter.</span>
        <span class="n">IInputFormatter</span> <span class="n">formatter</span> <span class="p">=</span> <span class="k">new</span> <span class="n">JsonFormatter</span><span class="p">(</span><span class="k">new</span> <span class="n">JsonSerializerSettings</span>
        <span class="p">{</span>
            <span class="n">ObjectCreationHandling</span> <span class="p">=</span> <span class="n">ObjectCreationHandling</span><span class="p">.</span><span class="n">Reuse</span>
        <span class="p">});</span>

        <span class="c1">// If reading directly from the content you&#39;ll have to specify the content formatter to use.</span>
        <span class="n">responseBody</span> <span class="p">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="n">ReadAsAsync</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;(</span><span class="n">formatter</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="some-basic-data-types">
<h3>Some basic data-types<a class="headerlink" href="#some-basic-data-types" title="Permalink to this headline">¶</a></h3>
<div class="highlight-csharp notranslate" id="data-types"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Customer</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Age</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">enum</span> <span class="n">ErrorCode</span>
<span class="p">{</span>
    <span class="n">Unknown</span> <span class="p">=</span> <span class="m">0</span><span class="p">,</span>
    <span class="n">EntityNotFound</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
    <span class="n">AccessDenied</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span>
    <span class="n">InternalError</span> <span class="p">=</span> <span class="m">3</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Error</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">ErrorMessage</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">ErrorCode</span> <span class="n">ErrorCode</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../typed/index.html" class="btn btn-neutral float-right" title="HttpRequest&lt;TContext&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="HttpRequest" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Adam Friedman.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.8.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>